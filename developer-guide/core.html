<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      Homital-Core | Homital
    </title>
    <meta name="description" content="The ultimate smart home ecosystem">
    <link rel="stylesheet" href="/assets/style.76cc18f9.css">
    <link rel="modulepreload" href="/assets/Home.5cd9b5da.js">
    <link rel="modulepreload" href="/assets/app.6f7ae0b0.js">
    <link rel="modulepreload" href="/assets/developer-guide_core.md.836b9f10.lean.js">
    <link rel="modulepreload" href="/assets/app.6f7ae0b0.js">
    
    
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-5df6160f><div class="sidebar-button" data-v-5df6160f><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Homital, back to home" data-v-5df6160f data-v-8dbfef3c><!----> Homital</a><div class="flex-grow" data-v-5df6160f></div><div class="nav" data-v-5df6160f><nav class="nav-links" data-v-5df6160f data-v-38e3b123><!--[--><div class="item" data-v-38e3b123><div class="nav-link" data-v-38e3b123 data-v-45eb32c6><a class="item" href="/" data-v-45eb32c6>Home <!----></a></div></div><div class="item" data-v-38e3b123><div class="nav-link" data-v-38e3b123 data-v-45eb32c6><a class="item" href="/user-guide/" data-v-45eb32c6>User Guide <!----></a></div></div><div class="item" data-v-38e3b123><div class="nav-dropdown-link" data-v-38e3b123 data-v-6bbf01f6><button class="button" data-v-6bbf01f6><span class="button-text" data-v-6bbf01f6>Developer Guide</span><span class="right button-arrow" data-v-6bbf01f6></span></button><ul class="dialog" data-v-6bbf01f6><!--[--><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item active" href="/developer-guide/" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>General Guide</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item active" href="/developer-guide/core" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>Homital-Core</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item" href="/developer-guide/app" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>Homital-App</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item" href="/developer-guide/light" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>Homital-Light</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item" href="/developer-guide/usb" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>Homital-USB_Adapter</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item" href="/developer-guide/docs" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>Homital-Docs</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><!--]--></ul></div></div><!--]--><!----><div class="item" data-v-38e3b123><div class="nav-link" data-v-38e3b123 data-v-45eb32c6><a class="item isExternal" href="https://github.com/Homital/Homital.github.io" target="_blank" rel="noopener noreferrer" data-v-45eb32c6>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-45eb32c6><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-58e261f2><nav class="nav-links nav" data-v-58e261f2 data-v-38e3b123><!--[--><div class="item" data-v-38e3b123><div class="nav-link" data-v-38e3b123 data-v-45eb32c6><a class="item" href="/" data-v-45eb32c6>Home <!----></a></div></div><div class="item" data-v-38e3b123><div class="nav-link" data-v-38e3b123 data-v-45eb32c6><a class="item" href="/user-guide/" data-v-45eb32c6>User Guide <!----></a></div></div><div class="item" data-v-38e3b123><div class="nav-dropdown-link" data-v-38e3b123 data-v-6bbf01f6><button class="button" data-v-6bbf01f6><span class="button-text" data-v-6bbf01f6>Developer Guide</span><span class="right button-arrow" data-v-6bbf01f6></span></button><ul class="dialog" data-v-6bbf01f6><!--[--><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item active" href="/developer-guide/" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>General Guide</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item active" href="/developer-guide/core" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>Homital-Core</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item" href="/developer-guide/app" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>Homital-App</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item" href="/developer-guide/light" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>Homital-Light</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item" href="/developer-guide/usb" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>Homital-USB_Adapter</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><li class="dialog-item" data-v-6bbf01f6><div class="nav-dropdown-link-item" data-v-6bbf01f6 data-v-d552fd76><a class="item" href="/developer-guide/docs" data-v-d552fd76><span class="arrow" data-v-d552fd76></span><span class="text" data-v-d552fd76>Homital-Docs</span><span class="icon" data-v-d552fd76><!----></span></a></div></li><!--]--></ul></div></div><!--]--><!----><div class="item" data-v-38e3b123><div class="nav-link" data-v-38e3b123 data-v-45eb32c6><a class="item isExternal" href="https://github.com/Homital/Homital.github.io" target="_blank" rel="noopener noreferrer" data-v-45eb32c6>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-45eb32c6><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-58e261f2><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#architecture">Architecture</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#database-model">Database Model</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#project-structure">Project Structure</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#setup">Setup</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#local-setup">Local Setup</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#cloud-setup">Cloud Setup</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#continuous-integration">Continuous Integration</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#testing">Testing</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#unit-testing">Unit Testing</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#api-testing">API Testing</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-d36a7fda><div class="container" data-v-d36a7fda><!--[--><!--]--><div class="content" data-v-d36a7fda><div data-v-d36a7fda><h1 id="homital-core"><a class="header-anchor" href="#homital-core" aria-hidden="true">#</a> Homital-Core</h1><p><a href="https://github.com/Homital/Homital-Core" target="_blank" rel="noopener noreferrer">GitHub</a></p><p>Homital-Core is the backend of the Homital system.</p><h2 id="architecture"><a class="header-anchor" href="#architecture" aria-hidden="true">#</a> Architecture</h2><p>Once correctly set up, Homital-Core exposes all its services as APIs at <code>http://homital.ml:2333/api/</code> or <code>https://homital.ml:2333/api/</code> if ran in production mode. It is also possible to specify the port as a command line argument.</p><p>The API documentation can be found <a href="https://app.swaggerhub.com/apis-docs/Homital/Homital-Core/0.1.0/" target="_blank" rel="noopener noreferrer">here</a></p><h2 id="database-model"><a class="header-anchor" href="#database-model" aria-hidden="true">#</a> Database Model</h2><p><img src="/assets/database.83788f9f.png" alt="Database model"></p><h2 id="project-structure"><a class="header-anchor" href="#project-structure" aria-hidden="true">#</a> Project Structure</h2><div class="language-homital"><pre><code>.
├── .github (GitHub configuration files)
│   └── ISSUE_TEMPLATE
│   │   └── ...
│   │ 
├── app
│   ├── db (Database models and functions)
│   │   ├── models (Schema and model definitions)
│   │   │   ├── device.js (Device model)
│   │   │   ├── room.js (Room model)
│   │   │   ├── status.js (Status model)
│   │   │   ├── token.js (Token model)
│   │   │   └── user.js (User model)
│   │   └── db.js (Database functions)
│   │ 
│   ├── routers (Routers)
│   │   │── api.js (Routes all API requests to their specific endpoints)
│   │   │── auth.js (Handles authentication requests)
│   │   │── device.js (Handles requests from devices)
│   │   │── deviceupdates.js (Handles device update requests)
│   │   └── user.js (Handles user requests)
│   │ 
│   ├── utils (Shared utilities)
│   │   └── utils.js
│   │ 
│   └── index.js (App entry point)
│ 
├── tests
│   ├── API_tests
│   │   ├── Homital.postman_collection.json (Postman Collection)
│   │   ├── Homital.postman_environment.json (Postman Environment)
│   │   └── Homital.postman_test_run.json (Postman test result)
│   └── unit_tests
│       └── test.js (Mocha test script)
│── .eslintrc.yml
│── .gitignore
│── .gitpod.yml
│── .remarkrc
│── README.md
│── package-lock.json
│── package.json
└── serve_log.js (Serves logs to aid development)
</code></pre></div><h2 id="setup"><a class="header-anchor" href="#setup" aria-hidden="true">#</a> Setup</h2><h3 id="local-setup"><a class="header-anchor" href="#local-setup" aria-hidden="true">#</a> Local Setup</h3><p>Follow the steps below to set up the project on a Ubuntu server.</p><ol><li>Open a shell session (maybe through SSH)</li><li>Install pre-requisites: <ul><li>Python 3 (Miniconda) <ul><li>Update package information: <code>sudo apt update</code></li><li>Install curl and git: <code>sudo apt install curl git</code></li><li>Download and install Miniconda: <code>sh -c &quot;$(curl -fsSL https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh)&quot;</code><ul><li>During the installation, you will be prompted to choose where to install Miniconda, if you are not sure what this means, just use the default location</li><li>When the installation finishes, it will show some bash commands which should have been automatically appended to your bashrc, if you are using another shell like zsh, copy the commands to the respective rc file and load the file: <code>source &lt;YOUR-RC-FILE&gt;</code></li></ul></li><li>Test Python installation: <code>python --version</code></li></ul></li><li>Node.js <ul><li>Install NVM (Node Version Manager): <code>curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash</code></li><li>Follow the instructions to append the provided commands to the end of your shell&#39;s rc file and load the file</li><li>Verify the installation: <code>command -v nvm</code></li><li>Install the latest LTS version of node: <code>nvm install node</code></li><li>Test the node installation: <code>node -v</code></li></ul></li></ul></li><li>Clone the repository: <code>git clone https://github.com/Homital/Homital-Core.git</code></li><li>Inside the cloned folder, run <code>npm install</code> to install Node.js dependencies</li><li>Create a file <code>.env</code> under the root directory of the repository and add the following entries, each on a new line, following by <code>=&lt;ITS_VALUE&gt;</code><ul><li><code>ACCESS_TOKEN_SECRET</code></li><li><code>REFRESH_TOKEN_SECRET</code></li><li><code>HOMITALDB_CONNECTIONSTRING</code></li><li><code>HTTPS_KEY</code></li><li><code>HTTPSCERT</code></li><li><code>NOREPLY_EMAIL_HOST</code></li><li><code>NOREPLY_EMAIL_PORT</code></li><li><code>NOREPLY_EMAIL_ADDR</code></li><li><code>NOREPLY_EMAIL_PASS</code></li></ul></li><li>To automatically pull the latest commits from GitHub, clone this repository: <code>git clone https://github.com/Homital/WebHook.git</code></li><li>Open <code>config.py</code> and edit the <code>GIT_REPO_PATH</code> value so that it matches the path of the <code>Homital-Core</code> repository we just cloned</li><li>Install <code>screen</code>: <code>sudo apt update&amp;&amp;sudo apt install screen</code></li><li>Start the python script <code>autoPull.py</code> in a new screen session: <code>screen -S webhook -dm bash -c &quot;python &lt;path_to_autoPull.py&gt;&quot;</code></li></ol><p>Watch it in a recording:</p><div class="danger custom-block"><p class="custom-block-title">WARNING</p><p>missing <code>npm install</code>, if no time, ignore the issue and delete this block</p></div><p><a href="https://asciinema.org/a/349158" target="_blank" rel="noopener noreferrer"><img src="https://asciinema.org/a/349158.svg" alt="asciicast"></a></p><h3 id="cloud-setup"><a class="header-anchor" href="#cloud-setup" aria-hidden="true">#</a> Cloud Setup</h3><p>It is possible to develop Homital-Core in the cloud using <a href="https://gitpod.io/" target="_blank" rel="noopener noreferrer">Gitpod</a> as long as you have a stable connection.</p><p>Click on the following badge to open Homital-Core in Gitpod: <a href="https://gitpod.io/#https://github.com/Homital/Homital-Core" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Gitpod-Ready--to--Code-blue?logo=gitpod" alt="Gitpod Ready-to-Code"></a></p><p>When Gitpod opens the repository, it will automatically install Node.js dependencies, so there is no need to do <code>npm install</code>. However, you still need to create and edit the <code>.env</code> file. as seen in the last section (step3).</p><h3 id="continuous-integration"><a class="header-anchor" href="#continuous-integration" aria-hidden="true">#</a> Continuous Integration</h3><p>If you followed the manual setup above and installed <code>Homital/WebHook</code>, it would listen to port <code>8888</code> for incoming <code>POST</code> requests. A <code>POST</code> request will trigger a <code>git pull</code> to get the latest updates from GitHub. To automatically update when the code on GitHub is updated, open the repo on GitHub, go to <code>Settings</code> -&gt; <code>Webhooks</code> -&gt; <code>Add webhook</code>, and put <code>http://&lt;SERVER-IP-ADDRESS-OR-DOMAIN&gt;:8888</code> in the <code>Payload URL</code> field. <code>Content type</code> and <code>secret</code> do not matter. Under <code>Which events would you like to trigger this webhook?</code>, choose <code>Just the push event</code>, and mark it <code>active</code>. Save the new webhook. If confused, see the picture below.</p><p><img src="/assets/webhook_setup.b5348377.png" alt="webhook setup"></p><h2 id="testing"><a class="header-anchor" href="#testing" aria-hidden="true">#</a> Testing</h2><h3 id="unit-testing"><a class="header-anchor" href="#unit-testing" aria-hidden="true">#</a> Unit Testing</h3><p><code>test/unit_tests/test.js</code> is a Mocha test script that tests all non-database-related functions.</p><p>Run it with <code>npm test</code>.</p><p><img src="/assets/unit_testing.7d91c95f.png" alt="unit tests"></p><h3 id="api-testing"><a class="header-anchor" href="#api-testing" aria-hidden="true">#</a> API Testing</h3><p>The <code>test/API_tests</code> folder contains Postman collection with test scripts for all listed APIs and environment variables.</p><ul><li><code>Homital.postman_collection.json</code> is a Postman Collection</li><li><code>Homital.postman_environment.json</code> is a Postman Environment</li><li><code>Homital.postman_test_run.json</code> is the Postman test results</li></ul><p>Download <code>Homital.postman_collection.json</code> and <code>Homital.postman_environment.json</code>.</p><p>Import the two files:</p><p><img src="/assets/postman1.171185d8.png" alt="Postman1"></p><p><img src="/assets/postman2.ea1f8f15.png" alt="Postman2"></p><p><img src="/assets/postman3.0f7f7758.png" alt="Postman3"></p><p><img src="/assets/postman4.c57790fd.png" alt="Postman4"></p><p>Select the imported environment:</p><p><img src="/assets/postman5.561d7a6f.png" alt="Postman5"></p><p>Check the environment:</p><p><img src="/assets/postman6.f5e1ce7a.png" alt="Postman6"></p><p>Run collection:</p><p><img src="/assets/postman7.6f10d3d7.png" alt="Postman7"></p><p><img src="/assets/postman8.397df64b.png" alt="Postman8"></p><p>Select options and run:</p><p><img src="/assets/postman9.d27a5e60.png" alt="Postman9"></p><p>Results:</p><p><img src="/assets/postman_results.6a0b448a.png" alt="API tests"></p></div></div><footer class="page-footer" data-v-d36a7fda data-v-5a019cc9><div class="edit" data-v-5a019cc9><div class="edit-link" data-v-5a019cc9 data-v-3ae295f1><a class="link" href="https://github.com/Homital/Homital.github.io/edit/docs/docs/developer-guide/core.md" target="_blank" rel="noopener noreferrer" data-v-3ae295f1>Help us improve this page! <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-3ae295f1><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-5a019cc9><p class="last-updated" data-v-5a019cc9 data-v-52854a16><span class="prefix" data-v-52854a16>Last Updated:</span><span class="datetime" data-v-52854a16></span></p></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"1991385c\",\"developer-guide_app.md\":\"29fbcb62\",\"developer-guide_core.md\":\"836b9f10\",\"developer-guide_docs.md\":\"1008d741\",\"developer-guide_index.md\":\"8718013a\",\"developer-guide_light.md\":\"6cfa4f26\",\"developer-guide_usb.md\":\"d3a52069\",\"user-guide_index.md\":\"cabecee7\"}")</script>
    <script type="module" async src="/assets/app.6f7ae0b0.js"></script>
  </body>
</html>